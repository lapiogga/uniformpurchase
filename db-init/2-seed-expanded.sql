-- 피복구매시스템 확장 시드 데이터 (2-seed-expanded.sql)
-- 데이터 간의 논리적 정합성 및 충분한 테스트 데이터 제공용

-- 기존 데이터 초기화 (정합성 보장)
TRUNCATE tailoring_tickets, order_items, orders, inventory_log, inventory, point_ledger, point_summary, product_specs, products, categories, users, tailors, stores CASCADE;

-- 1. 판매소 (Stores) - 전국 주요 부대 및 지역 반영
INSERT INTO stores (id, name, address, contact, manager_name) VALUES
('00000000-0000-0000-0000-000000000001', '육군본부 계룡대 판매소', '충남 계룡시 계룡대로 663', '042-123-4567', '김판매'),
('00000000-0000-0000-0000-000000000011', '서울 용산 외인판매소', '서울특별시 용산구 이태원로', '02-790-1234', '이용산'),
('00000000-0000-0000-0000-000000000012', '국방부 직할 판매소', '서울특별시 용산구 두텁바위로', '02-748-1111', '박국방'),
('00000000-0000-0000-0000-000000000013', '상무대(장성) 판매소', '전남 장성군 삼서면', '061-393-0000', '최상무'),
('00000000-0000-0000-0000-000000000014', '자운대(대전) 판매소', '대전광역시 유성구 신성동', '042-870-0000', '정자운'),
('00000000-0000-0000-0000-000000000015', '1군단(고양) 판매소', '경기도 고양시 덕양구', '031-964-0011', '한일군'),
('00000000-0000-0000-0000-000000000016', '3군단(인제) 판매소', '강원도 인제군 기린면', '033-461-0011', '조삼군'),
('00000000-0000-0000-0000-000000000017', '작전사(대구) 판매소', '대구광역시 수성구', '053-750-0011', '윤작전'),
('00000000-0000-0000-0000-000000000018', '2군단(춘천) 판매소', '강원도 춘천시 신북읍', '033-242-0011', '강이군'),
('00000000-0000-0000-0000-000000000019', '특전사(이천) 판매소', '경기도 이천시 마장면', '031-644-0011', '황특전');

-- 2. 체척업체 (Tailors) - 맞춤 피복 제작 업체
INSERT INTO tailors (id, name, business_number, representative, address, contact) VALUES
('00000000-0000-0000-0001-000000000001', '(주)군복장인', '101-81-12345', '김장인', '서울특별시 광진구', '02-111-2222'),
('00000000-0000-0000-0001-000000000002', '대한테일러', '202-85-67890', '이대한', '대전광역시 동구', '042-444-5555'),
('00000000-0000-0000-0001-000000000003', '명품군제복', '303-88-11111', '박명품', '대구광역시 남구', '053-622-3333'),
('00000000-0000-0000-0001-000000000004', '한일정복', '404-81-22222', '최한일', '부산광역시 부산진구', '051-808-4444'),
('00000000-0000-0000-0001-000000000005', '충성양복점', '505-86-33333', '정충성', '강원도 원주시', '033-742-5555');

-- 3. 품목 분류 (Categories)
INSERT INTO categories (id, name, level, sort_order) VALUES
('10000000-0000-0000-0000-000000000001', '전투복', 1, 1),
('10000000-0000-0000-0000-000000000002', '정복/예복', 1, 2),
('10000000-0000-0000-0000-000000000003', '체력단련복', 1, 3),
('10000000-0000-0000-0000-000000000004', '신발류', 1, 4),
('10000000-0000-0000-0000-000000000005', '장구/속옷류', 1, 5);

INSERT INTO categories (id, name, parent_id, level, sort_order) VALUES
('11000000-0000-0000-0000-000000000001', '사계절 전투복', '10000000-0000-0000-0000-000000000001', 2, 1),
('11000000-0000-0000-0000-000000000002', '하절기 전투복', '10000000-0000-0000-0000-000000000001', 2, 2),
('12000000-0000-0000-0000-000000000001', '장교 정복', '10000000-0000-0000-0000-000000000002', 2, 1),
('12000000-0000-0000-0000-000000000002', '부사관 정복', '10000000-0000-0000-0000-000000000002', 2, 2),
('14000000-0000-0000-0000-000000000001', '전투화', '10000000-0000-0000-0000-000000000004', 2, 1),
('14000000-0000-0000-0000-000000000002', '단화/운동화', '10000000-0000-0000-0000-000000000004', 2, 2);

-- 4. 품목 (Products)
INSERT INTO products (id, category_id, name, product_type, base_price, image_url, description) VALUES
-- 완제품
('20000000-0000-0000-0000-000000000001', '11000000-0000-0000-0000-000000000001', '사계절 전투복 상의', 'finished', 48000, null, '신형 디지털 패턴 사계절용 전투복 상의'),
('20000000-0000-0000-0000-000000000002', '11000000-0000-0000-0000-000000000001', '사계절 전투복 하의', 'finished', 42000, null, '신형 디지털 패턴 사계절용 전투복 하의'),
('20000000-0000-0000-0000-000000000003', '11000000-0000-0000-0000-000000000002', '하절기 전투복 상의', 'finished', 45000, null, '통기성이 강화된 하절기 전투복 상의'),
('20000000-0000-0000-0000-000000000004', '14000000-0000-0000-0000-000000000001', '기능성 전투화', 'finished', 85000, null, '고어텍스 소재의 경량 기능성 전투화'),
('20000000-0000-0000-0000-000000000005', '10000000-0000-0000-0000-000000000003', '동계 체력단련복 상하세트', 'finished', 65000, null, '보온성이 뛰어난 동계 체력단련복 세트'),
('20000000-0000-0000-0000-000000000006', '10000000-0000-0000-0000-000000000005', '기능성 런닝(3매입)', 'finished', 15000, null, '흡습속건 기능이 포함된 내부 런닝'),
('20000000-0000-0000-0000-000000000007', '10000000-0000-0000-0000-000000000005', '전투양말(5켤레)', 'finished', 12000, null, '내구성이 강화된 군용 전투양말'),
-- 맞춤피복
('20000000-0001-0000-0000-000000000001', '12000000-0000-0000-0000-000000000001', '육군 장교 정복 상의(맞춤)', 'custom', 185000, null, '고급 원단을 사용한 맞춤형 장교 정복 상의'),
('20000000-0001-0000-0000-000000000002', '12000000-0000-0000-0000-000000000001', '육군 장교 정복 하의(맞춤)', 'custom', 110000, null, '맞춤형 장교 정복 하의'),
('20000000-0001-0000-0000-000000000003', '12000000-0000-0000-0000-000000000002', '육군 부사관 정복 세트(맞춤)', 'custom', 280000, null, '맞춤형 부사관 정복 세트');

-- 5. 규격 (Product Specs) - 인벤토리 연동을 위해 고정 ID 사용
INSERT INTO product_specs (id, product_id, spec_name, sort_order) VALUES
-- 사계절 전투복 상의 규격
('30000000-0000-0000-0000-000000000001', '20000000-0000-0000-0000-000000000001', '95(L)', 1),
('30000000-0000-0000-0000-000000000002', '20000000-0000-0000-0000-000000000001', '100(XL)', 2),
('30000000-0000-0000-0000-000000000003', '20000000-0000-0000-0000-000000000001', '105(2XL)', 3),
-- 사계절 전투복 하의 규격
('30000000-0000-0000-0001-000000000001', '20000000-0000-0000-0000-000000000002', '80(30인치)', 1),
('30000000-0000-0000-0001-000000000002', '20000000-0000-0000-0000-000000000002', '85(32인치)', 2),
('30000000-0000-0000-0001-000000000003', '20000000-0000-0000-0000-000000000002', '90(34인치)', 3),
-- 기능성 전투화 규격
('30000000-0000-0000-0004-000000000001', '20000000-0000-0000-0000-000000000004', '260EE', 1),
('30000000-0000-0000-0004-000000000002', '20000000-0000-0000-0000-000000000004', '265EE', 2),
-- 맞춤용 규격
('30000000-0001-0000-0000-000000001001', '20000000-0001-0000-0000-000000000001', '체척기반 맞춤', 1),
('30000000-0001-0000-0000-000000001003', '20000000-0001-0000-0000-000000000003', '체척기반 맞춤', 1);

-- 6. 사용자 (Users)
INSERT INTO users (id, email, password, name, role, rank, military_number, unit, enlist_date, promotion_date, retirement_date, is_active, store_id, tailor_id) VALUES
-- Admin
('00000000-0000-0000-0000-000000000000', 'admin@mil.kr', 'test1234', '관리자', 'admin', 'major', '05-10042', '육군본부 군수참모부', '2005-03-01', '2015-01-01', null, true, null, null),
-- Store Managers
('00000000-0000-0000-0000-000010000001', 'store1@mil.kr', 'test1234', '김판매', 'store', 'master_sgt', '10-20031', '육군본부 계룡대 판매소', '2010-06-01', '2020-01-01', null, true, '00000000-0000-0000-0000-000000000001', null),
-- Tailor Employees
('00000000-0000-0000-0000-000020000001', 'tailor1@mil.kr', 'test1234', '김테일러', 'tailor', null, null, '(주)군복장인', '2020-01-01', null, null, true, null, '00000000-0000-0000-0001-000000000001'),
-- General Users
('00000000-0000-0000-0000-000000000002', 'hong@mil.kr', 'test1234', '홍길동', 'user', 'captain', '15-12345', '제1보병사단', '2015-03-01', '2020-01-01', null, true, null, null),
('00000000-0000-0000-0000-000000000022', 'kim@mil.kr', 'test1234', '김철수', 'user', 'sgt', '18-54321', '제2작전사령부', '2018-05-15', '2022-01-01', null, true, null, null),
('00000000-0000-0000-0000-000000000023', 'lee@mil.kr', 'test1234', '이순신', 'user', 'colonel', '00-99999', '합동참모본부', '2000-01-01', '2018-01-01', '2026-12-31', true, null, null),
('00000000-0000-0000-0000-000000000024', 'park@mil.kr', 'test1234', '박문수', 'user', 'general', '95-11111', '지상작전사령부', '1995-02-01', '2022-01-01', null, true, null, null),
('00000000-0000-0000-0000-000000000025', 'choi@mil.kr', 'test1234', '최영', 'user', 'master_sgt', '12-76543', '제5보병사단', '2012-09-01', '2021-01-01', null, true, null, null);

-- 7. 포인트 요약 (Point Summary)
INSERT INTO point_summary (user_id, total_granted, used_points, reserved_points) VALUES
('00000000-0000-0000-0000-000000000002', 1050000, 0, 0),
('00000000-0000-0000-0000-000000000022', 440000, 0, 0),
('00000000-0000-0000-0000-000000000023', 850000, 0, 0),
('00000000-0000-0000-0000-000000000024', 2000000, 0, 0),
('00000000-0000-0000-0000-000000000025', 680000, 0, 0)
ON CONFLICT (user_id) DO UPDATE SET total_granted = EXCLUDED.total_granted;

-- 8. 포인트 원장 (Point Ledger)
INSERT INTO point_ledger (user_id, point_type, amount, fiscal_year, description, reference_type) VALUES
('00000000-0000-0000-0000-000000000002', 'grant', 1050000, 2026, '2026년 정기 포인트 지급', 'annual'),
('00000000-0000-0000-0000-000000000022', 'grant', 440000, 2026, '2026년 정기 포인트 지급', 'annual'),
('00000000-0000-0000-0000-000000000023', 'grant', 850000, 2026, '2026년 정기 포인트 지급', 'annual'),
('00000000-0000-0000-0000-000000000024', 'grant', 2000000, 2026, '2026년 정기 포인트 지급', 'annual'),
('00000000-0000-0000-0000-000000000025', 'grant', 680000, 2026, '2026년 정기 포인트 지급', 'annual');

-- 9. 재고 (Inventory) - 모든 판매소에 기본 재고 할당
INSERT INTO inventory (store_id, product_id, spec_id, quantity)
SELECT 
    s.id, 
    p.id, 
    ps.id, 
    (FLOOR(RANDOM() * 50) + 20)::INT
FROM stores s, products p
JOIN product_specs ps ON p.id = ps.product_id
WHERE p.product_type = 'finished';

-- 10. 주문 및 체척권 예시 (홍길동의 지난 주문)
INSERT INTO orders (id, order_number, user_id, store_id, order_type, product_type, status, total_amount) VALUES
('50000000-0000-0000-0000-000000000001', 'ORD-20260115-00001', '00000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000001', 'offline', 'finished', 'delivered', 48000);

-- 주문 상세
INSERT INTO order_items (id, order_id, product_id, spec_id, quantity, unit_price, subtotal) VALUES
('50000000-0000-0000-0001-000000000001', '50000000-0000-0000-0000-000000000001', '20000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000001', 1, 48000, 48000);

-- 포인트 차감 반영
UPDATE point_summary SET used_points = 48000 WHERE user_id = '00000000-0000-0000-0000-000000000002';
INSERT INTO point_ledger (user_id, point_type, amount, description, reference_type, reference_id) 
VALUES ('00000000-0000-0000-0000-000000000002', 'deduct', 48000, '오프라인 구매 차감', 'order', '50000000-0000-0000-0000-000000000001');

